name: Wevtutil Usage To Disable Logs
id: a4bdc944-cdd9-11eb-ac97-acde48001122
version: 2
date: '2021-06-15'
author: Teoderick Contreras, Splunk
type: TTP
status: production
description: This search is to detect execution of wevtutil.exe to disable logs. This
  technique was seen in several ransomware to disable the event logs to evade alerts
  and detections in compromised host.
logsource:
  - Windows Security 4688
  - Sysmon Event Code 1
  - Carbon Black Process 
search:
  selection:
    CommandLine|contains: 'sl'
    CommandLine|contains: '/e:false'
    Image|endswith: 'wevtutil.exe'
  condition: selection
how_to_implement: You must be ingesting data that records process activity from your
  hosts to populate the Endpoint data model in the Processes node. You must also be
  ingesting logs with both the process name and command line from your endpoints.
  The command-line arguments are mapped to the "process" field in the Endpoint data
  model.
known_false_positives: network operator may disable audit event logs for debugging
  purposes.
references:
- https://www.bleepingcomputer.com/news/security/new-ransom-x-ransomware-used-in-texas-txdot-cyberattack/
tags:
  analytic_story:
  - Windows Log Manipulation
  - Ransomware
  confidence: 90
  impact: 70
  message: message here
  drilldown: drilldown search here (pre generated) (optional field)
  mitre_attack_id:
  - T1070
  - T1070.001
  product:
  - Splunk Behavioral Analytics
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  risk_score: 63
  risk_severity: medium
  security_domain: endpoint
  asset_type: Endpoint
test:
- name: Wevtutil Usage To Disable Logs SRS
  product: BA
  pass_condition: '@count_gt(0)'
  attack_data:
  - file_name: disable_evt.log
    data: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1070.001/ssa_wevtutil/disable_evt.log
    source: WinEventLog:Security
- name: Wevtutil Usage To Disable Logs Sysmon
  product: ESCU
  pass_condition: '@count_gt(0)'
  attack_data:
  - file_name: sysmon.log
    data: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1070.001/atomic_red_team/windows-sysmon.log
    source: XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
    sourcetype: xmlwineventlog
- name: Wevtutil Usage To Disable Logs CarbonBlack
  product: ESCU
  pass_condition: '@count_gt(0)'
  attack_data:
  - file_name: carbon-black.log
    data: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1070.001/atomic_red_team/carbon-black.log
    sourcetype: cb:events